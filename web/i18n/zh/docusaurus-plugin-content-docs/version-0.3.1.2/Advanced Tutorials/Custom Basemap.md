---
sidebar_position: 1
---

# 🎨 自定义底图

对于绘图而言，我们在最近的一次更新从底层重新设计了底图文件的逻辑，现在我们可以通过软件自由的创建，修改，导入和删除底图。

:::info

我们鼓励贡献者创建相关底图，参与贡献，一起共建更美好的软件。

我们计划将会在不久创建类似于社区的环境，提供底图的上传和下载服务。以便于广泛传播。

:::

## 编辑模式

现在你可以通过左上角的 `文件`-> `编辑模式` 进入编辑模式，如下图所示：

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/EditModeMenu.png)

在进入编辑模式后，会有三个部分的改变：

1. 之前工具栏替换为了编辑模式特有的便捷工具。
   ![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/EditModeToolBar.png)
2. 对于编辑模式而言，他拥有自己特有的项目列表，也就是说，他和默认绘图模式下的绘图列表是不同的，这里可以理解为编辑自定义底图的项目列表。
3. 对于一些绘图元素的属性会展示绘图位置等相关属性。

## 自定义底图

现在你可以通过 `文件`-> `编辑模式` 进行底图的新建，如下图所示：

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/NewBasemap.png)

新建底图会有一个弹窗，如下图所示。其中需要填写底图类别参数，你可以把他理解为“特殊的项目名称”，输入的内容需要满足如下格式要求：

1. 使用英文字符`,`作为分隔符。
2. 一级类别建议为国家语言，例如：`English` 或者 `简体中文`。
3. 后续类别随意，但是建议二级类别以`岩浆岩`,`变质岩`,`沉积岩`,`其他`等命名，三级类别以功能命名（例如：`构造环境`），四级类别以作者名称+时间命名（例如：`Lucy  (2020)`），五级类别以所需元素命名（例如：`TiO2-SiO2-Y`）

以一个正常的名称举例`English,Igneous Rock,Rock Category,TAS` ，最终类别将会以如下的规则直观的展示：

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/NameRule.png)

需要注意的是在创建项目文件后并不会直接创建底图文件，只有点击保存后才会创建对应的底图文件。底图文件的格式是`json`。文件的命名规则基于分类路径，即对于这个例子而言就是`English_Igneous Rock_Rock Category_TAS.json` 。

底图文件的存放路径是：基于程序的安装位置下->`Data`->`PlotData`->`Custom`文件夹下。

需要注意的是，一个完整的底图文件需要满足如下几个部分的填写：

1. **底图绘制**：即完成绘图底图。
2. **脚本设置**：填写底图投图所需要的参数和执行脚本。
3. **指南编写**：在指南部分按照一定格式编写底图的指南内容。

### 底图绘制

底图绘制主要依托于工具栏和属性面板。

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/EditModeToolBar.png)

* **添加线条**：线条也成为边界，触发规则是点击添加线条按钮后，在绘图上点击起始点和终止点即可创建。尽管这么创建会有些粗糙，但是你可以在图层面板中选中刚刚创建的边界，在属性面板对位置进行微调。
* **添加注释**：注释也成为文本，触发规则类似，点击添加文本后，点击绘图中指定的位置即可创建。默认的注释文本为`Text`，修改文本位置或者内容，也是从图层面板的属性位置进行修改。
* **添加多边形**：该功能类似于前面，添加一个闭合的多边形，通过左键连续点击创建点，右键闭合图形。
* **脚本设置**：填写一些必要的投图参数和参数计算规则。详细的内容将会在后续讲述。
* **保存**：保存底图，只有点击保存底图后，才会触发底图文件的形成。
* **退出编辑模式**：退出编辑模式，回到默认的绘图界面。

#### 添加线条

如下是一个添加线条的属性面板示例，通过属性面板可以对线条的位置和其他属性进行精细化的调整。右侧的定位图标触发后，在绘图区域左键点击后会自动设置位置为点击的位置（该功能还在开发中）。

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/ShuXinMianBan.png)

### 脚本设置

脚本设置是投图中重要的环节，他规定了自定义的投图逻辑是什么。一共需要两个参数：投图参数和脚本。如下图所示：

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/JsSetting.png)

对于脚本参数，即投图读取的 `xlsx`，`xls`，`csv` 数据文件中需要读取哪些列的数据。输入的规则是以英文`,` 为分隔。

**现在默认的情况下第一个参数必须是`Group`**，即组别。他会在投图的时候区分不同的数据点分类，进而影响图例的类别展示。剩下的参数需要根据自定义的底图所需进行。

脚本默认使用 `JavaScript` 语言编写。关于 `JavaScript` 的一些基本语法可以查看相关内容，此处不过多赘述。

例如：参数填写：`Group,SiO2,Na2O,K2O`。脚本内容如下：

```javascript
// 使用变量 K2O + Na2O 计算
var result1 = K2O + Na2O;
// 使用 SiO2 计算
var result2 = SiO2;
// 返回两个计算值，需要注意的是对于默认的二维坐标轴图像返回值只有两个
// 第一个位置代表了 X 的返回值，第二个位置是 Y 的返回值。
[result2, result1]
```

### 指南编写

指南的编写也是重要的一环，可以快速让普通用户了解，底图的基础信息和使用。如下图所示位置进行指南编写。

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/GuideContent.png)

你可以选择直接编写，不过我们更加倾向于使用 Office 或者 WPS 创建 `rtf` 文件，在该文件中编写内容，并创建对应的样式，然后粘贴过来即可。如下图所示：

![](https://geo-1303234197.cos.ap-hongkong.myqcloud.com/RTFGuide.png)

对于指南的编写格式，我们建议以如下的格式为标准：

* 简介：负责介绍底图的一些基础概念和作用。帮助用户快速了解底图。
* 数据格式：负责规定输入的数据格式是什么，即输入的数据列标题应该是什么才能合法读取对应的数据。
* 参考文献：关于编写这个底图及其相关内容所参考的内容。
* 贡献者：参与该底图的相关人员名称或者昵称，这取决于你的兴趣，甚至可以放上你的个人网站，这完全是被鼓励的。

:::info

Some functions may not yet be fully implemented; we are working to improve them to provide a better user experience. ✨

:::
